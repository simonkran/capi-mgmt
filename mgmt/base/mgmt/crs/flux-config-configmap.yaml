apiVersion: v1
kind: ConfigMap
metadata:
  name: flux-config-dev
  namespace: default
data:
  flux-sync.yaml: |
    ---
    apiVersion: source.toolkit.fluxcd.io/v1
    kind: GitRepository
    metadata:
      name: capi-mgmt
      namespace: flux-system
    spec:
      interval: 1m0s
      ref:
        branch: main
      url: https://github.com/simonkran/capi-mgmt
    ---
    apiVersion: kustomize.toolkit.fluxcd.io/v1
    kind: Kustomization
    metadata:
      name: mgmt-cluster-0
      namespace: flux-system
    spec:
      interval: 5m0s
      path: ./mgmt/dev/mgmt-0
      prune: true
      sourceRef:
        kind: GitRepository
        name: capi-mgmt
      healthChecks:
        - apiVersion: cluster.x-k8s.io/v1beta1
          kind: Cluster
          name: capi-quickstart
          namespace: default
      timeout: 30m
      retryInterval: 2m
      postBuild:
        substitute:
          CLUSTER_NAME: "capi-quickstart"
          CLUSTER_ENV: "dev"
          CONTROL_PLANE_MACHINE_COUNT: 1
          WORKER_MACHINE_COUNT: 1
          KUBERNETES_VERSION: v1.34.0
